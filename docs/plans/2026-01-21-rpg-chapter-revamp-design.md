# RPG Chapter Revamp Design

## Context & Intent
This change responds to the request to make the pre-simulation setup explicit, eliminate idle arena filler, and deepen Chapters 3–5 with tighter pacing, stronger explanations, and richer interactivity. Constraints: no clarifying questions, preserve CRT aesthetic, use real MiniLM embedding outputs for any numeric display, keep Ch3–Ch5 height to roughly half of Ch1/Ch2 (target ~200px min height), and validate every phase with Playwright screenshots. The existing stack already has persona/audience/tweet configuration and a timeline-driven chapter system, so the design should fold setup into the chapter canvas as a formal step and then shift focus to the simulation chapters once “BEGIN SIMULATION” is invoked. Visual direction stays CRT: green phosphor, scanlines, glow, data-grid styling, animated scan/flow.

## Options Considered
Option A (recommended): add a new “Loadout” chapter (Chapter 0) in the timeline, render it inside the chapter canvas when the simulation is idle, and jump to Chapter 1 once simulation begins. Reuse ConfigPanel logic inside a new Chapter0Scene, add a short narration and “Step 0A/0B/0C” presentation for persona, audience, and tweet. Replace the side-panel CRT controls with a hidden edge-handle that opens an in-screen CRT dialog. For Chapters 3–5, split each into 3–4 sub-steps that align with the design spec, showing one primary visualization at a time to keep height tight, and add new micro-interactions (hover details, animated scanning, and guided steps). Option B: keep the setup in the side panel and add a purely explanatory chapter for configuration. This keeps code simpler but violates the “arena subsumed by setup” request and makes the arena still empty while idle. Option C: hide the chapter canvas entirely when idle and show a large config panel that replaces it. This loses the narrative continuity of the timeline and prevents the configuration from being a chapter in the story.

## Selected Design (Architecture & Flow)
Adopt Option A. Add a Chapter0Scene that contains the persona/audience/tweet steps and a short narration; this scene renders in the chapter canvas when `simulationStarted` is false, replacing the placeholder. The timeline gains a new chapter labeled “Loadout / Mission Prep” and all existing chapters shift by +1 index. When “BEGIN SIMULATION” is pressed, reset simulation state and jump to Chapter 1, so playback begins at the Request step. Replace the fixed CRT controls panel with a side-edge handle that toggles an in-screen dialog; the dialog uses CRT styling and an overlay frame, with a subtle glow and scanline entrance animation.

Ch3 becomes four smaller steps (dedup, social graph, recency/history, content), each with a focused gate subset and a compact “why this gate matters” micro-callout. Ch4 becomes four steps: context tokens, attention weights, probability estimation (P(...)), and weighted score + ranking. The probability step uses actual embedding-based classification + action concepts to estimate probabilities (MiniLM-driven similarity), displayed as an animated probability rack. Attention weights become interactive: hover/auto-advance highlights a context token, illuminates its attention bar, and updates a short explanation line. Ch5 becomes three steps: top-K selection, visibility filtering, and delivery outcome. The outcome step includes a performance summary (“below / median / above average”), computed from embedding-driven probabilities + audience mix, and an avatar grid that emits like/comment/repost glyph bursts. All new components use CSS modules and CRT-like motion (scan sweeps, phosphor trails) and maintain compact height. Tests follow TDD: add/update unit tests for new components and chapter step conditions, then implement. Playwright screenshots capture each phase and final state.

## Assumptions
- The timeline can add a “Chapter 0” without breaking user expectations; timeline labels and current-function display will be updated accordingly.
- Engagement probability estimation can reuse existing `classifyContent` and `predictEngagement` results for realistic numbers, with additional embedding similarity to action concepts for visualization only.
- Compact chapter heights are achievable by splitting steps and showing one primary visualization per step.
- The CRT controls dialog is acceptable as an overlay inside the CRT screen, even though it is not part of the side-panel UI.
